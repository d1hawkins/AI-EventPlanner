<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI Event Planner SaaS - Reset your password">
    <title>Forgot Password - AI Event Planner SaaS</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/saas/css/styles.css">
    <style>
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .auth-card {
            width: 100%;
            max-width: 500px;
            padding: 2rem;
        }
        .brand-logo {
            font-size: 2rem;
            font-weight: bold;
            color: #4e73df;
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-xl-10 col-lg-12 col-md-9">
                    <div class="card o-hidden border-0 shadow-lg auth-card">
                        <div class="card-body p-0">
                            <div class="p-5">
                                <div class="text-center">
                                    <div class="brand-logo">
                                        <i class="bi bi-calendar-event me-2" aria-hidden="true"></i>
                                        AI Event Planner
                                    </div>
                                    <h1 class="h4 text-gray-900 mb-2">Forgot Your Password?</h1>
                                    <p class="mb-4 text-muted">
                                        No worries! Enter your email address below and we'll send you a link to reset your password.
                                    </p>
                                </div>

                                <!-- Alert Container -->
                                <div id="alertContainer"></div>

                                <!-- Reset Password Form -->
                                <form id="forgotPasswordForm" class="user">
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email Address</label>
                                        <input type="email" class="form-control form-control-lg" id="email" name="email" placeholder="Enter your email address" required>
                                    </div>

                                    <button type="submit" class="btn btn-primary btn-lg w-100" id="submitBtn">
                                        <i class="bi bi-envelope me-2" aria-hidden="true"></i>
                                        Send Reset Link
                                    </button>
                                </form>

                                <hr class="my-4">

                                <div class="text-center">
                                    <a href="/saas/login.html" class="text-decoration-none">
                                        <i class="bi bi-arrow-left me-2" aria-hidden="true"></i>
                                        Back to Login
                                    </a>
                                </div>

                                <div class="text-center mt-3">
                                    <p class="small text-muted">
                                        Don't have an account? <a href="/saas/signup.html">Sign up</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Help Text -->
                    <div class="text-center mt-4">
                        <div class="card bg-light border-0">
                            <div class="card-body py-3">
                                <h6 class="mb-2"><i class="bi bi-question-circle me-2" aria-hidden="true"></i>Need Help?</h6>
                                <p class="small text-muted mb-0">
                                    If you're having trouble resetting your password, please contact our support team at
                                    <a href="mailto:support@aieventplanner.com">support@aieventplanner.com</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('forgotPasswordForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const submitBtn = document.getElementById('submitBtn');
            const alertContainer = document.getElementById('alertContainer');
            const originalBtnText = submitBtn.innerHTML;

            // Clear previous alerts
            alertContainer.innerHTML = '';

            try {
                // Disable button and show loading state
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Sending...';

                // Make API call to request password reset
                const response = await fetch('/api/auth/forgot-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });

                if (response.ok) {
                    // Show success message
                    alertContainer.innerHTML = `
                        <div class="alert alert-success" role="alert">
                            <i class="bi bi-check-circle me-2" aria-hidden="true"></i>
                            <strong>Success!</strong> If an account exists with this email, you will receive a password reset link shortly.
                            Please check your email inbox and spam folder.
                        </div>
                    `;

                    // Clear form
                    this.reset();

                    // Redirect to login after 5 seconds
                    setTimeout(() => {
                        window.location.href = '/saas/login.html';
                    }, 5000);
                } else {
                    const data = await response.json();
                    throw new Error(data.detail || 'Failed to send reset link');
                }
            } catch (error) {
                console.error('Error:', error);

                // Show error message
                alertContainer.innerHTML = `
                    <div class="alert alert-danger" role="alert">
                        <i class="bi bi-exclamation-triangle me-2" aria-hidden="true"></i>
                        <strong>Error!</strong> ${error.message}. Please try again or contact support.
                    </div>
                `;

                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            }
        });

        // Email validation
        document.getElementById('email').addEventListener('input', function() {
            const email = this.value;
            const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);

            if (email && !isValid) {
                this.setCustomValidity('Please enter a valid email address');
            } else {
                this.setCustomValidity('');
            }
        });
    </script>
</body>
</html>
